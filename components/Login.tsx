
import React, { useState } from 'react';
import { supabase } from '../lib/supabase';

interface LoginProps {
  onLoginSuccess: (session: any) => void;
}

const TagwayFullLogo = ({ className = "w-full max-w-[450px]" }: { className?: string }) => (
  <svg 
    viewBox="0 0 3649.72 2663.39" 
    className={className}
    xmlns="http://www.w3.org/2000/svg" 
    xmlSpace="preserve"
    fillRule="evenodd"
    clipRule="evenodd"
    shapeRendering="geometricPrecision"
    textRendering="geometricPrecision"
    imageRendering="optimizeQuality"
  >
    <g id="Camada_x0020_1">
      <path fill="#4D4D4D" fillRule="nonzero" d="M315.83 2660.36l0 -606.44 212.91 0 0 -102.92 -528.74 0 0 102.92 213.92 0 0 606.44 101.91 0zm437.93 -555.99l86.78 249.24 -175.57 0 88.8 -249.24zm210.89 552.96l108.98 0 -283.54 -715.41 -74.67 0 -283.54 715.41 109.99 0c22.2,-58.52 57.52,-143.28 84.76,-207.86l253.27 0 84.76 207.86zm769.9 -453.06c-37.33,-187.68 -200.8,-257.3 -336.01,-257.3 -194.75,0 -347.11,149.34 -347.11,358.21 0,207.86 149.34,357.2 347.11,357.2 128.15,0 273.45,-86.78 321.89,-221.99l0 1.01c9.08,-23.21 14.13,-62.56 19.17,-122.1l-380.41 0 0 101.91 261.34 0c-42.38,102.92 -135.21,143.28 -221.99,143.28 -138.24,0 -245.2,-109.98 -245.2,-259.32 0,-148.33 106.96,-256.3 245.2,-256.3 89.8,0 198.78,41.37 227.03,155.39l108.98 0zm568.09 459.12l75.68 0 235.11 -711.38 -106.96 0c-52.47,160.44 -114.02,340.05 -169.52,508.56l-115.03 -328.95 -81.73 0 -116.04 329.96 -168.51 -509.57 -105.95 0 235.11 711.38 75.68 0c36.32,-106.96 79.71,-227.03 120.08,-342.07l122.09 342.07zm540.85 -559.01l86.78 249.24 -175.57 0 88.8 -249.24zm210.89 552.96l108.98 0 -283.54 -715.41 -74.67 0 -283.54 715.41 109.99 0c22.2,-58.52 57.52,-143.28 84.76,-207.86l253.27 0 84.76 207.86zm-31.28 -705.32l261.34 417.75 0 287.58 102.92 0 0 -287.58 262.35 -417.75 -121.08 0 -192.73 309.78 -192.73 -309.78 -120.08 0z" />
      <g id="_1949129827600">
        <path fill="#8200AD" d="M2171.31 1803.17c-121.23,0 -222.52,-66.46 -246.93,-155.11l0 -277.18 206.11 0 81.46 141.08c-7.29,11.73 -11.51,25.57 -11.51,40.4 0,42.3 34.29,76.59 76.59,76.59 42.3,0 76.59,-34.29 76.59,-76.59 0,-42.3 -34.29,-76.59 -76.59,-76.59 -4.1,0 -8.14,0.32 -12.07,0.95l-97.79 -169.38 -242.79 0 0 -161.08 -63.55 0 0 510c12.19,125.11 146.54,223.67 310.48,223.67 140.51,0 259.28,-72.41 298.04,-171.87 121.55,6.86 238.8,-97.72 270.41,-247.75 14.88,-70.6 8.34,-139.65 -14.63,-197.43 86.64,-78.89 141.26,-212.45 136.27,-361.82 -6.51,-195.17 -112.73,-355.75 -251.49,-399.94 11.74,-29.35 18.21,-61.39 18.21,-94.94 0,-141.19 -114.46,-255.65 -255.65,-255.65 -14.41,0 -28.54,1.19 -42.3,3.48 -30.82,-89.07 -126.76,-154.02 -240.33,-154.02 -101.63,0 -189.14,52.01 -228.5,126.78l0 622.47 63.54 0 0 -136.36 160.97 0 111.74 -202.47 1.3 -2.36c2.73,-0.42 5.42,-0.98 8.05,-1.68 10.91,-4.97 21.35,-10.6 31.23,-16.85 15.72,-14.03 25.62,-34.44 25.62,-57.17 0,-42.3 -34.29,-76.59 -76.59,-76.59 -42.3,0 -76.59,34.29 -76.59,76.59 0,22.83 9.99,43.33 25.83,57.36l-88.1 159.63 -123.46 0 0 -393.26c37.69,-45.01 97.95,-74.15 165.86,-74.15 99.04,0 181.82,62 202.04,144.78 19.94,-6.14 41.11,-9.44 63.06,-9.44 118.2,0 214.02,95.82 214.02,214.02 0,39.35 -10.62,76.22 -29.15,107.9 136.37,42.24 240.18,187.21 246.62,362.96 5.45,148.84 -60.38,280.45 -161.41,348.53 25.09,39.81 39.66,87.35 39.66,138.4 0,140.23 -109.99,253.91 -245.66,253.91 -0.13,0 -0.25,0 -0.38,0 -21.88,91.17 -124.7,160.18 -248.24,160.18z" />
        <path fill="#8200AD" d="M2305.03 1177.34l106.61 43.16c7.63,34.25 38.21,59.86 74.76,59.86 42.3,0 76.59,-34.29 76.59,-76.59 0,-42.3 -34.29,-76.59 -76.59,-76.59 -24.92,0 -47.06,11.9 -61.05,30.32l-107.96 -43.7 -216.84 0 0 63.55 204.46 0z" />
        <path fill="#8200AD" d="M2377.53 938.82l187.54 0c11.82,27.05 38.81,45.95 70.22,45.95 42.3,0 76.59,-34.29 76.59,-76.59 0,-42.3 -34.29,-76.59 -76.59,-76.59 -30.52,0 -56.88,17.86 -69.18,43.69l-205.37 0 -100.6 57.16 -160.51 0 0 63.55 177.31 0 4.32 -2.46 96.27 -54.71z" />
        <path fill="#8200AD" d="M2203 806.07l190.33 -168.56c13.8,13.43 32.65,21.71 53.43,21.71 42.3,0 76.59,-34.29 76.59,-76.59 0,-42.3 -34.29,-76.59 -76.59,-76.59 -38.89,0 -71.01,28.98 -75.94,66.53l-193.48 171.34 -78.87 0 0 63.55 104.52 0 0 -1.39z" />
        <path fill="#FF6600" d="M1080.87 854.68l-216.24 15.62c16.99,-161.23 116.33,-291.46 244.36,-331.12 -1.55,-2.66 -3.05,-5.35 -4.49,-8.08l140.95 58.9c2.28,19.46 14.18,35.98 30.8,44.69l-63.39 119.35c-7.68,-1.73 -15.67,-2.64 -23.87,-2.64 -58.12,0 -105.54,45.8 -108.13,103.27zm164.67 -87.35l67.37 -126.83 2.1 -3.96 2.99 2.87 138.22 132.3c-0.69,1.85 -1.26,3.77 -1.7,5.73l-179.78 16.14c-8.04,-10.42 -17.94,-19.33 -29.2,-26.23zm479.8 631.64l0 249.1c-8.82,32.01 -27.65,61.12 -53.83,85.26l-274.6 -199.88c3.46,-8.55 5.37,-17.9 5.37,-27.7 0,-4.65 -0.43,-9.21 -1.26,-13.62l127.5 -17.12c10.65,14.34 27.72,23.63 46.96,23.63 32.29,0 58.46,-26.17 58.46,-58.46 0,-4.56 -0.52,-9 -1.51,-13.27l92.91 -27.93zm-244.86 -652.61l-132.17 -126.51c8.15,-10.01 13.04,-22.78 13.04,-36.69 0,-32.11 -26.03,-58.14 -58.14,-58.14 -21.85,0 -40.88,12.05 -50.82,29.87l-165.56 -69.18c-4.56,-17.38 -6.98,-35.61 -6.98,-54.42 0,-118.2 95.82,-214.02 214.02,-214.02 21.95,0 43.13,3.31 63.06,9.44 20.22,-82.78 103,-144.78 202.04,-144.78 67.91,0 128.17,29.15 165.86,74.15l0 415 -111.43 -1.12 -68.89 -129.7c21,-13.5 34.91,-37.06 34.91,-63.88 0,-33.57 -21.8,-62.05 -52.02,-72.06l-8.23 -97.2 -35.05 1.86 7.82 92.39c-36.4,5.58 -64.29,37.03 -64.29,75 0,41.91 33.97,75.88 75.88,75.88 2.51,0 4.98,-0.12 7.43,-0.36l81.22 152.93 132.63 1.33 0 6.72 0 136.05 63.55 0 0 -622.16c-39.36,-74.76 -126.87,-126.78 -228.51,-126.78 -113.57,0 -209.5,64.95 -240.33,154.02 -13.76,-2.29 -27.89,-3.48 -42.3,-3.48 -141.19,0 -255.65,114.46 -255.65,255.65 0,33.55 6.46,65.59 18.21,94.94 -138.76,44.18 -244.98,204.77 -251.49,399.94 -4.99,149.37 49.63,282.93 136.27,361.82 -22.97,57.77 -29.5,126.83 -14.63,197.43 31.61,150.03 148.86,254.61 270.41,247.75 38.75,99.47 157.53,171.87 298.04,171.87 148.49,0 272.7,-80.86 303.85,-189.06 3.24,-11.26 5.48,-22.81 6.62,-34.61l0 -512.47 -62.55 0 0 233.19 -1 0.3 -101.22 30.43c-10.48,-15.69 -28.36,-26.02 -48.64,-26.02 -32.29,0 -58.46,26.18 -58.46,58.46 0,0.31 0,0.62 0.01,0.94l-131.61 17.67c-3.46,-4.2 -7.38,-8.01 -11.68,-11.35l94.4 -207.35c25.55,-7.46 42.63,-31.1 42.03,-57.66 -2.96,-15.79 -2.2,-18.85 -10.85,-32.43l0 0c-10.6,-14.83 -27.97,-24.5 -47.59,-24.5 -4.05,0 -8,0.41 -11.82,1.2l-163.32 -203.38c13,-17.86 20.67,-39.85 20.67,-63.64 0,-11.3 -1.73,-22.2 -4.95,-32.45l168.76 -15.15c7.97,11.75 21.44,19.47 36.71,19.47 24.49,0 44.34,-19.85 44.34,-44.34 0,-24.49 -19.85,-44.34 -44.34,-44.34 -6.14,0 -11.98,1.25 -17.3,3.5zm-529.43 437.05c-57.74,-71.56 -91.92,-170.01 -88.79,-277.71l222.69 -16.09c8.36,29.11 28.62,53.19 55.16,66.65l-119.27 202.38c-3.24,-0.38 -6.53,-0.58 -9.87,-0.58 -23.51,0 -44.75,9.71 -59.92,25.35zm237.95 -215.5c23.25,0 44.79,-7.33 62.43,-19.81l157.45 196.06c-8.7,9.36 -14.37,21.59 -15.44,35.1l-298.97 62.57c0,-0.09 0,-0.18 0,-0.27 0,-30.09 -15.91,-56.46 -39.78,-71.15l119.9 -203.45c4.71,0.63 9.53,0.95 14.41,0.95zm-204.88 421.17c0,-22.85 2.92,-45 8.4,-66.06 5.93,1.34 12.11,2.05 18.45,2.05 20.19,0 38.7,-7.16 53.14,-19.09l197.3 168.79c-4.36,9.42 -6.8,19.92 -6.8,30.99 0,3.59 0.26,7.11 0.75,10.56l-162.61 83.53c-65.52,-45.6 -108.61,-122.98 -108.61,-210.76zm144.88 231.63l139.59 -71.71c13.41,18.53 35.22,30.58 59.85,30.58 18.28,0 35.01,-6.64 47.91,-17.65l266.43 193.93c-44.17,29.49 -101.6,47.31 -164.37,47.31 -123.54,0 -226.36,-69.01 -248.24,-160.18 -0.12,0 -0.25,0 -0.38,0 -35.91,0 -70.03,-7.97 -100.78,-22.28zm-42.04 -341.41l314.31 -65.78c6.59,11.21 16.81,20.03 29.04,24.85l-88.65 194.72c-4.29,-0.77 -8.7,-1.18 -13.21,-1.18 -16.98,0 -32.63,5.74 -45.1,15.37l-196.37 -168zm-1.67 0.35c0.21,-0.41 0.42,-0.83 0.63,-1.24l1.04 0.89 -1.67 0.35z" />
        <path fill="#FF6600" fillRule="nonzero" d="M1695.98 1079.33l0 -219.87 77.19 0 0 -37.32 -191.7 0 0 37.32 77.56 0 0 219.87 36.95 0zm257.57 1.1l27.44 0 85.24 -257.92 -38.78 0c-19.02,58.17 -41.34,123.29 -61.46,184.38l-41.71 -119.26 -29.63 0 -42.07 119.63 -61.1 -184.75 -38.41 0 85.24 257.92 27.44 0c13.17,-38.78 28.9,-82.31 43.53,-124.02l44.27 124.02z" />
      </g>
    </g>
  </svg>
);

const Login: React.FC<LoginProps> = ({ onLoginSuccess }) => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    const loginEmail = email.includes('@') ? email : `${email}@tagway.com.br`;
    
    try {
      const { data, error } = await supabase.auth.signInWithPassword({ email: loginEmail, password });
      if (error) {
        alert(`Erro: ${error.message}`);
      } else if (data.session) {
        onLoginSuccess(data.session);
      }
    } catch (err: any) {
      alert(`Erro inesperado: ${err.message}`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-[#000000] flex flex-col md:flex-row items-stretch overflow-hidden">
      {/* Visual Side */}
      <div className="hidden md:flex flex-[1.4] bg-[#000000] p-10 flex-col justify-center items-center relative overflow-hidden">
        <div className="absolute top-0 right-0 w-[800px] h-[800px] bg-white/5 rounded-full blur-[150px] -mr-96 -mt-96"></div>
        
        <div className="relative z-10 animate-slide-up flex flex-col items-center">
          <TagwayFullLogo />
          <div className="mt-12 text-slate-400 space-y-4 max-w-md text-center">
            <p className="text-xl font-medium tracking-tight leading-snug">
              Plataforma determinística de inteligência fiscal de alta precisão.
            </p>
          </div>
        </div>
      </div>

      {/* Form Side */}
      <div className="flex-1 flex items-center justify-center p-6 md:p-8 bg-white md:rounded-l-[5rem] shadow-[-30px_0_60px_rgba(0,0,0,0.5)] z-20">
        <div className="w-full max-w-sm space-y-8 md:space-y-12">
          {/* Header Mobile */}
          <div className="md:hidden text-center flex flex-col items-center">
             <TagwayFullLogo className="w-full max-w-[280px]" />
          </div>
          
          <div className="space-y-3">
            <h2 className="text-3xl md:text-4xl font-black text-slate-900 tracking-tighter">Acesso.</h2>
            <p className="text-slate-500 font-medium text-sm">Entre no sistema com suas credenciais.</p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-6">
            <div className="space-y-4">
              <div className="space-y-1.5">
                <label className="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1">E-mail ou Usuário</label>
                <input 
                  type="text"
                  required
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="admin@tagway.com.br"
                  className="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-bold outline-none focus:border-black transition-all"
                />
              </div>
              <div className="space-y-1.5">
                <label className="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1">Senha</label>
                <input 
                  type="password"
                  required
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="••••••••"
                  className="w-full bg-slate-50 border border-slate-200 rounded-2xl px-6 py-4 text-sm font-bold outline-none focus:border-black transition-all"
                />
              </div>
            </div>
            
            <button 
              type="submit" 
              disabled={isLoading}
              className="w-full bg-black text-white py-5 rounded-2xl font-black uppercase tracking-[0.2em] text-[10px] shadow-2xl transition-all btn-touch disabled:opacity-50"
            >
              {isLoading ? 'Autenticando...' : 'Entrar'}
            </button>
          </form>

          <footer className="pt-6 md:pt-10 text-center border-t border-slate-100">
             <p className="text-[8px] md:text-[9px] font-black text-slate-300 uppercase tracking-widest leading-relaxed">
               © 2025 TAGWAY TECHNOLOGY — Business Intelligence<br/>
               Sistemas de Alta Precisão
             </p>
          </footer>
        </div>
      </div>
    </div>
  );
};

export default Login;
